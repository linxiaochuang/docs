# Debugging Applications

PHP offers tools to debug applications with notices, warnings, errors and exceptions. The [Exception class] offers information such as the file,
line, message, numeric code, backtrace etc. on where an error occurred. OOP frameworks like ManaPHP mainly use this class to encapsulate
this functionality and provide information back to the developer or user.

## Catching Exceptions
Throughout the tutorials and examples of the ManaPHP documentation, there is a common element that is catching exceptions. This is a try/catch block:

```php
    <?php

    try {

        // ... Some ManaPHP/PHP code

    } catch (\Exception $e) {

    }
```

Any exception thrown within the block is captured in the variable `$e`. A `ManaPHP\\Exception` extends the
PHP [Exception class] and is used to understand whether the exception came from ManaPHP or PHP itself.

All exceptions generated by PHP are based on the [Exception class], and have at least the following elements:

```bash
    //Class synopsis

    class Exception
    {

        /* Properties */
        protected string $message;
        protected int $code;
        protected string $file;
        protected int $line;

        /* Methods */
        public __construct ([ string $message = "" [, int $code = 0 [, Exception $previous = NULL ]]])
        final public string getMessage ( void )
        final public Exception getPrevious ( void )
        final public mixed getCode ( void )
        final public string getFile ( void )
        final public int getLine ( void )
        final public array getTrace ( void )
        final public string getTraceAsString ( void )
        public string __toString ( void )
        final private void __clone ( void )
    }
```

Retrieving information from `ManaPHP\\Exception` is the same as PHP's [Exception class]:

```php
    <?php

    try {

        // ... App code ...

    } catch (ManaPHP\Exception $e) {
        echo get_class($e), ": ", $e->getMessage(), "\n";
        echo " File=", $e->getFile(), "\n";
        echo " Line=", $e->getLine(), "\n";
        echo $e->getTraceAsString();
    }
```

It's therefore easy to find which file and line of the application's code generated the exception, as well as the components involved in
generating the exception:

.. code-block:: html

    Fatal error: Uncaught exception 'PDOException' with message ' in D:\wamp\www\manaphp\ManaPHP\Db.php on line 113

    PDOException: SQLSTATE[HY000] [2002] No connection could be made because the target machine actively refused it.
     in D:\wamp\www\manaphp\ManaPHP\Db.php on line 113

    Call Stack:
        0.0000     132256   1. {main}() D:\wamp\www\manaphp\Public\index.php:0
        0.0080     353960   2. Application\Application->main() D:\wamp\www\manaphp\Public\index.php:21
        0.0130     471184   3. ManaPHP\Mvc\Application->handle() D:\wamp\www\manaphp\Application\Application.php:88
        0.0210     682544   4. ManaPHP\Mvc\Dispatcher->dispatch() D:\wamp\www\manaphp\ManaPHP\Mvc\Application.php:156
        0.0230     703616   5. call_user_func_array:{D:\wamp\www\manaphp\ManaPHP\Mvc\Dispatcher.php:326}() D:\wamp\www\manaphp\ManaPHP\Mvc\Dispatcher.php:326
        0.0230     703768   6. Application\Home\Controllers\IndexController->indexAction() D:\wamp\www\manaphp\ManaPHP\Mvc\Dispatcher.php:326
        0.0250     867720   7. ManaPHP\Mvc\Model::findFirst() D:\wamp\www\manaphp\Application\Home\Controllers\IndexController.php:19
        0.0270     949168   8. ManaPHP\Mvc\Model\MetaData->getPrimaryKeyAttributes() D:\wamp\www\manaphp\ManaPHP\Mvc\Model.php:348
        0.0270     949248   9. ManaPHP\Mvc\Model\MetaData->_readMetaData() D:\wamp\www\manaphp\ManaPHP\Mvc\Model\MetaData.php:146
        0.0270     949392  10. ManaPHP\Mvc\Model\MetaData->_fetchMetaDataFromRDBMS() D:\wamp\www\manaphp\ManaPHP\Mvc\Model\MetaData.php:106
        0.0270     950272  11. ManaPHP\Mvc\Model->getReadConnection() D:\wamp\www\manaphp\ManaPHP\Mvc\Model\MetaData.php:51
        0.0270     950304  12. ManaPHP\Mvc\Model\Manager->getReadConnection() D:\wamp\www\manaphp\ManaPHP\Mvc\Model.php:215
        0.0270     950384  13. ManaPHP\Di->getShared() D:\wamp\www\manaphp\ManaPHP\Mvc\Model\Manager.php:212
        0.0270     950416  14. ManaPHP\Di->get() D:\wamp\www\manaphp\ManaPHP\Di.php:155
        0.0270     950416  15. ManaPHP\Di\Service->resolve() D:\wamp\www\manaphp\ManaPHP\Di.php:122
        0.0270     950552  16. call_user_func:{D:\wamp\www\manaphp\ManaPHP\Di\Service.php:92}() D:\wamp\www\manaphp\ManaPHP\Di\Service.php:92
        0.0270     950592  17. Application\Application->Application\{closure}() D:\wamp\www\manaphp\ManaPHP\Di\Service.php:92
        0.0280    1056384  18. ManaPHP\Db\Adapter\Mysql->__construct() D:\wamp\www\manaphp\Application\Application.php:33
        0.0280    1056896  19. ManaPHP\Db->__construct() D:\wamp\www\manaphp\ManaPHP\Db\Adapter\Mysql.php:34
        0.0280    1057616  20. ManaPHP\Db->_connect() D:\wamp\www\manaphp\ManaPHP\Db.php:72
        0.0280    1058872  21. PDO->__construct() D:\wamp\www\manaphp\ManaPHP\Db.php:113

As you can see from the above output the ManaPHP's classes and methods are displayed just like any other component, and even showing the
parameters that were invoked in every call. The method [Exception::getTrace] provides additional information if needed.

## Debugger component

ManaPHP provides a `debugger` component that allows the developer to easily find errors produced in an application
created with the framework.
if you want get detail information, please refer to `debugger` component.

## Using XDebug

[XDebug] is an amazing tool that complements the debugging of PHP applications. It is also a C extension for PHP, and you can use it together
with ManaPHP without additional configuration or side effects.

Once you have xdebug installed, you can use its API to get a more detailed information about exceptions and messages.

>>    We highly recommend use at least XDebug 2.2.3 for a better compatibility with ManaPHP

The following example implements [xdebug_print_function_stack] to stop the execution and generate a backtrace:

```php

    <?php

    use ManaPHP\Mvc\Controller;

    class SignupController extends Controller
    {
        public function indexAction()
        {

        }

        public function registerAction()
        {
            // Request variables from HTML form
            $name  = $this->request->getPost("name", "string");
            $email = $this->request->getPost("email", "email");

            // Stop execution and show a backtrace
            return xdebug_print_function_stack("stop here!");

            $user        = new User();
            $user->name  = $name;
            $user->email = $email;

            // Store and check for errors
            $user->save();
        }
    }
```
In this instance, Xdebug will also show us the variables in the local scope, and a backtrace as well:

```html
    Xdebug: stop here! in /Applications/MAMP/htdocs/tutorial/app/controllers/SignupController.php
        on line 19

    Call Stack:
        0.0383     654600   1. {main}() /Applications/MAMP/htdocs/tutorial/public/index.php:0
        0.0392     663864   2. ManaPHP\Mvc\Application->handle()
            /Applications/MAMP/htdocs/tutorial/public/index.php:37
        0.0418     738848   3. SignupController->registerAction()
            /Applications/MAMP/htdocs/tutorial/public/index.php:0
        0.0419     740144   4. xdebug_print_function_stack()
            /Applications/MAMP/htdocs/tutorial/app/controllers/SignupController.php:19
```
Xdebug provides several ways to get debug and trace information regarding the execution of your application using ManaPHP. You can
check the [XDebug documentation] for more information.

[Pretty Exceptions]: https://github.com/phalcon/pretty-exceptions
[Exception class]: http://www.php.net/manual/en/language.exceptions.php
[Reflection API]: http://php.net/manual/en/book.reflection.php
[Exception::getTrace]: http://www.php.net/manual/en/exception.gettrace.php
[XDebug]: http://xdebug.org
[XDebug documentation]: http://xdebug.org/docs
[xdebug_print_function_stack]: http://xdebug.org/docs/stack_trace
